"use strict";
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="7b061089-440e-5e62-9e93-19bd14bbde28")}catch(e){}}();
(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[6007],{982386:(e,t,a)=>{a.d(t,{F:()=>n,HR:()=>r,Io:()=>i,Pn:()=>d,V_:()=>o,dK:()=>_,nM:()=>c,rH:()=>s,sQ:()=>l,ue:()=>m});let o="on_canvas_pill--pillContainer--jvRgr",n="on_canvas_pill--centered--iOUXI",i="on_canvas_pill--pill--fSukI",l="on_canvas_pill--bottom--gwvqA",s="on_canvas_pill--node--xgavI",r="on_canvas_pill--symbol--3Kz9f",c="on_canvas_pill--row--I6QoB",d="on_canvas_pill--pillLargeBorderRadius--9uWP9",_="on_canvas_pill--pillText--ts0Xi ellipsis--ellipsis--Tjyfa",m="on_canvas_pill--iconNodeType--0xm99"},590695:(e,t,a)=>{a.d(t,{N:()=>c,S:()=>d});var o=a(411855),n=a(38580),i=a(646240),l=a(374626);let s=(0,n.eU)(0),r=(0,n.eU)(e=>e(s)>0);function c({isVisible:e}){let t=(0,i.Xr)(s);(0,o.useLayoutEffect)(()=>{if(e)return t(e=>e+1),()=>t(e=>Math.max(0,e-1))},[e,t])}function d(){return(0,l.md)(r)}},168275:(e,t,a)=>{a.d(t,{d:()=>r});var o=a(411855),n=a(964881),i=a(335682),l=a(381915),s=a(503737);function r(){let e=(0,i.q5)(),t=(0,n.l7)(),a=(0,n.X0)();return e&&e.key&&e.name?o.createElement(s.SZ,{shouldUseBottomBorder:!a},o.createElement(s.x$,{shouldShowFileMenu:!t,recordingKey:s.Fp}),o.createElement(s.l9,null),o.createElement(s.t7,{openFile:e})):o.createElement(s.SZ,{shouldUseBottomBorder:!a},o.createElement(l.cQ,null))}},980150:(e,t,a)=>{a.d(t,{MO:()=>y,Tq:()=>T,q5:()=>O});var o=a(411855),n=a(612028),i=a(629019),l=a.n(i),s=a(886653),r=a(163023),c=a(259927),d=a(457630),_=a(371591),m=a(982386),E=a(116198),u=a(462725),p=a(968109),v=a(251232),g=a(416014),N=a(348844),I=a(313888),f=a(531800),w=a(142284),h=a(660257);function O(e,t,a,o){let n=(0,d._X)({subscribeToUpdates_expensive:!0});if(!n)return null;let i={},l=(0,d.Yb)(n,{x:e.x,y:e.y,width:e.w,height:e.h});return i.left=l.x+n.x,i.top=l.y+n.y,t&&(i.left+=l.width/2),a&&(i.top=l.y+n.y+l.height),{containerStyle:i,pillStyle:o&&{maxWidth:o(l.width)},zoomScale:n.zoomScale}}let y=o.forwardRef(function(e,t){let{boundingBox:a,isFigmaPurple:n}=e.node,i=O(a,e.centered,e.bottom,e.maxWidth);if(!i)return null;let{containerStyle:s,pillStyle:r}=i;return o.createElement("div",{ref:t,className:l()(c.Dm,m.V_,{[m.F]:e.centered,[m.sQ]:e.bottom}),style:{...s,marginLeft:e.offsetX??0,marginTop:e.offsetY?.(i.zoomScale)??0},"data-testid":e.dataTestId},o.createElement("div",{className:l()(m.Io,n?m.HR:m.rH,e.largeBorderRadius&&m.Pn),style:r},e.children))});function T({node:e}){let t=(0,s.xx)((e,t)=>(0,_.D)(e,t)),a=e?t(e.guid,e.objectsPanelThumbnailId):"",i=a?(0,r.V)(a):function(e){let t=null;switch(e.type){case"TEXT":t=w.A;break;case"FRAME":t=e.isGroup?u.A:e.isStateGroup?I.A:(0,_.GN)({stackMode:e.stackMode,stackCounterAlignItems:e.stackCounterAlignItems});break;case"ROUNDED_RECTANGLE":t=g.A;break;case"ELLIPSE":t=E.A;break;case"STAR":t=N.A;break;case"VECTOR":t=h.A;break;case"GROUP":t=u.A;break;case"INSTANCE":t=p.A;break;case"SYMBOL":t=e.isState?f.A:I.A}return(0,n.oY)(e.type)&&e.hasEnabledStaticImagePaint&&(t=v.A),t}(e);return i?o.createElement(r.B,{className:m.ue,svg:i}):null}},113316:(e,t,a)=>{a.d(t,{h:()=>D});var o=a(411855),n=a(188507),i=a(520411),l=a(504440),s=a(343887),r=a(397863),c=a(139689),d=a(921211),_=a(939683),m=a(966712),E=a(915440),u=a(711525),p=a(99380),v=a(564577),g=a(493323),N=a(939863),I=a(67294),f=a(391119),w=a(738269),h=a(973149),O=a(177505),y=a(335682),T=a(611978),b=a(279453),A=a(335650);let C="recordings_entrypoint_window--secondaryText--nAp30";function D(e){let t=o.useContext(p.q5),a=(0,y.q5)(),n=a?.key,d=(0,i.U1)(),_=o.useMemo(()=>({fileKey:n??""}),[n]),v=(0,E.Rs)(b.bCq,_,{enabled:(0,m.kc)().async_spotlight}),{onClose:I}=e;o.useEffect(()=>{(0,m.kc)().async_spotlight&&a&&(0,A.Q3)(a,A.ZP.RECORDINGS_WINDOW_OPENED,A.uT.SIDEBAR)},[a]);let f=o.useCallback(()=>{(0,A.Q3)(a,A.ZP.NEW_RECORDING_BUTTON_CLICKED,A.uT.SIDEBAR),t.initializeRecordingMedia(),I()},[I,t,a]),w=o.useMemo(()=>{if("loaded"!==v.status||v.data.walkthroughMediaByFileKey.status!==u.tT.Loaded)return[];let e=v.data.walkthroughMediaByFileKey.data;return e?e.sort((e,t)=>t.createdAt.getTime()-e.createdAt.getTime()):[]},[v]);return(0,m.kc)().async_spotlight&&n?o.createElement("div",{className:"recordings_entrypoint_window--windowContainer--dPDES",ref:d},o.createElement("div",{className:"recordings_entrypoint_window--windowHeader--r4wNv"},o.createElement("div",{className:"recordings_entrypoint_window--windowTitle--eDl4P"},(0,N.tx)("recordings.recordings")),o.createElement("div",{className:"recordings_entrypoint_window--windowHeaderRight--QHvmv"},o.createElement("button",{onClick:f,className:"recordings_entrypoint_window--actionStrip--xnHRK"},o.createElement(r.x,null),(0,N.tx)("recordings.new_recording")),o.createElement(s.K,{onClick:e.onClose,"aria-label":(0,N.t)("general.close")},o.createElement(c.A,null)))),"loaded"!==v.status||v.data.walkthroughMediaByFileKey.status!==u.tT.Loaded?o.createElement("div",{className:"recordings_entrypoint_window--loadingSpinnerContainer--r2n7-"},o.createElement(g.kt,null)):0===w.length?o.createElement("div",{className:"recordings_entrypoint_window--emptyStateContainer--QYgG-"},o.createElement("div",{className:"recordings_entrypoint_window--emptyStateTextSection--fpTRu"},o.createElement("div",{className:"recordings_entrypoint_window--boldText---2EPl"},(0,N.tx)("recordings.no_recordings_yet")),o.createElement("div",{className:C},(0,N.tx)("recordings.make_context_setting_easier"))),o.createElement(l.$n,{onClick:f},(0,N.tx)("recordings.new_recording"))):o.createElement("div",{className:"recordings_entrypoint_window--recordingsContainer--5-i0S"},w.map(t=>o.createElement(R,{recording:t,onClose:e.onClose,key:t.id})))):null}function R(e){let t=(0,T._6)(),a=(0,n.wA)(),i=(0,y.q5)(),l=(0,O.dh)(),s=(0,n.d4)(e=>e.versionHistory),r=(0,_.U)(),c=o.useMemo(()=>new h.f0(Number.POSITIVE_INFINITY,!1,!1),[]),[m,E]=o.useState(!1),p=async()=>{if("fullscreen"===t.view){(0,A.J1)(i.key,i.editorType,A.NA.SIDEBAR,e.recording.id),l!==e.recording.meta.pageId&&await (0,O.$P)(e.recording.meta.pageId,l,s,a,!1,r);let o={...t,walkthroughRecordingId:e.recording.id};a((0,w.$T)(o)),e.onClose()}},g=e.recording.meta.lengthMs.status===u.tT.Loaded?e.recording.meta.lengthMs.data:null,b=g?c.format(g/1e3):null;return o.createElement("div",{className:"recordings_entrypoint_window--recordingRow--tEVbx",key:e.recording.id,onClick:p,tabIndex:0,role:"button",onMouseEnter:()=>E(!0),onMouseLeave:()=>E(!1)},o.createElement("div",{className:"recordings_entrypoint_window--profileImg--ssJ-s"},m?o.createElement(d.K,{className:"recordings_entrypoint_window--hoverPlayIcon--UZ5-8"}):o.createElement(f.H,{user:e.recording.creator,size:I.Pf.LARGE})),o.createElement("div",{className:"recordings_entrypoint_window--recordingInfo--mvIzC"},o.createElement("div",{className:"recordings_entrypoint_window--recordingInfoTopRow--8eH08"},o.createElement("div",{className:"recordings_entrypoint_window--recordingTitle--GdNUG"},(0,N.tx)("recordings.month_day",{monthStr:e.recording.createdAt.toLocaleString("default",{month:"short"}),dayNumber:e.recording.createdAt.getDate()})," - ",e.recording.meta.title),o.createElement("div",{className:C},o.createElement(v.h1,{date:e.recording.createdAt,style:"short"}))),o.createElement("div",{className:C},b," \xb7 ",e.recording.creator.handle)))}},625693:(e,t,a)=>{a.d(t,{s:()=>tg});var o=a(411855),n=a(188507),i=a(891093),l=a(226055),s=a(860178),r=a(902938),c=a(327017),d=a(571232),_=a(636751),m=a(629019),E=a.n(m),u=a(563706),p=a(939863),v=a(29680),g=a(866564),N=a(590695),I=a(498606),f=a(7959),w=a(976930),h=a(842439),O=a(588930);let y="voice_widget--modal--xsQ2A",T="voice_widget--show--O6ORx voice_widget--modal--xsQ2A",b="voice_widget--icon--wW-wb",A="voice_widget--iconContainer--CuKNM",C="voice_widget--muteButtonPosition--J282V",D="voice_widget--topRow--O1wj-",R="voice_widget--voiceModalPanel--KD-J1";function k(e){let{fileKey:t}=e;var{userIdsInCall:a}=(0,d.W5)(t);let n=a.size,i=(0,v.aV)(),l=(0,s.iZ)();o.useEffect(()=>{!u.XN&&l?.id&&!a.has(l.id)&&(0,g.w$)(n)},[n,l?.id,a]);let r=!i&&!u.XN;return((0,N.N)({isVisible:r}),r)?o.createElement("div",{className:E()(y,{[T]:!0})},o.createElement(f.Id,{className:R},o.createElement("div",{className:D},o.createElement("div",{className:"voice_widget--joinModalCountGroup--zxI6Q"},o.createElement(w.A.HeadphonesIcon,{className:O.QH,size:24}),a.size),o.createElement(h.K,{fileKey:e.fileKey,"data-tooltip-type":I.Ib.TEXT,"data-tooltip":(0,p.t)("collaboration.voice.join_conversation"),isJoinWidget:!0,"data-onboarding-key":"audio-nux-key"},(0,p.tx)("collaboration.voice.join"))))):o.createElement(o.Fragment,null)}var S=a(520411),L=a(139689),W=a(182550),P=a(36381),U=a(27087),x=a(46481),M=a(738269),$=a(662275),G=a(988022),B=a(373205),V=a(338400),F=a(325538),H=a(928491),j=a(752019),z=a(281381),K=a(163023),X=a(507877),J=a(318812),Y=a(728587),q=a(227795);let Q="captions_dialog--showGradient--ZAHRk";var Z=a(727507),ee=a(554653);let et="DROPDOWN_TYPE_CAPTIONS_DIALOG_TYPE_SIZE";function ea({caption:e,user:t}){let a=e.userId+"_"+e.timestamp;return o.createElement("div",{className:"captions_dialog--captionRow--pgS-N",key:a},o.createElement("div",null,o.createElement(H.Ro,{className:"captions_dialog--avatar--ISexR",entity:{...t,id:e.userId},size:24}),o.createElement("div",{className:"captions_dialog--name--SmWv6"},t?t.name:e.userId)),e.text.map((e,t)=>o.createElement("div",{className:"captions_dialog--paragraph--SjDQd",key:a+"_"+t},e.map((e,n)=>o.createElement("div",{className:"captions_dialog--sentence--SJkHn",key:a+"_"+t+"_"+n},`${e} `)))))}let eo=()=>({small:{style:"captions_dialog--smallText--aUeBx",label:(0,p.t)("collaboration.voice.small")},medium:{style:"captions_dialog--mediumText--ODxEN",label:(0,p.t)("collaboration.voice.medium")},large:{style:"captions_dialog--largeText---t1d2",label:(0,p.t)("collaboration.voice.large")},x_large:{style:"captions_dialog--xlargeText--C60DA",label:(0,p.t)("collaboration.voice.x_large")}}),en=Date.now();function ei({call:e}){let t=eo(),[a,i]=o.useState([]),[l,s]=o.useState(t.small.style),[r,c]=o.useState(!1),[_,m]=o.useState(!1),[E,u]=o.useState(!1),v=(0,n.d4)(e=>{if(!e.openFile)throw Error("Open file required");return e.openFile}),g=(0,n.d4)(e=>e.voice.activeCall[v.key]),N=(0,n.wA)(),[f,w]=o.useState(null),h=(0,J.Um)(),O=o.useRef(null),y=!!(h&&h.type===et),T=a.reduce((e,t)=>e.add(t.userId),new Set),b=(0,d.bF)(T,v.key).reduce((e,t)=>(e[t.userID]=t,e),{});o.useEffect(()=>{let t=e=>{e&&i(e)};return e.audioCaptionStream.subscribe(t),()=>e.audioCaptionStream.unsubscribe(t)}),o.useEffect(()=>{f&&f.scrollHeight-f.scrollTop-f.clientHeight<150&&en<Date.now()-150&&f.scrollTo({top:f.scrollHeight-f.clientHeight,behavior:"smooth"})}),o.useEffect(()=>{f&&!E&&(f.scrollTop=f.scrollHeight-f.clientHeight)},[f,E]);let A=!E&&g;return o.createElement("div",{className:["captions_dialog--captionsDialog--gOIvh",l].join(" ")},o.createElement("div",{className:["captions_dialog--topDivider--BlM0x captions_dialog--_divider--m8Skg",r?Q:""].join(" ")}),A&&o.createElement("div",{className:"captions_dialog--scrollContainer--WuVOJ",ref:e=>w(e),onScroll:e=>{f&&(m(0!=f.scrollHeight-f.scrollTop-f.clientHeight),c(0!==f.scrollTop))},onWheel:e=>{e.deltaY<0&&(en=Date.now())}},o.createElement("div",{className:"captions_dialog--scrollContainerInner--db2cV"},a.map(e=>o.createElement(ea,{key:e.timestamp,caption:e,user:b[e.userId]})))),A&&o.createElement("div",{className:["captions_dialog--bottomDivider--WBbo5 captions_dialog--_divider--m8Skg",_?Q:""].join(" ")}),A&&o.createElement("button",{onClick:()=>f.scrollTo({top:f.scrollHeight-f.clientHeight,behavior:"smooth"}),className:`captions_dialog--scrollToBottomButton--SeU-4 ${_?"captions_dialog--show--LLYog":""}`},(0,p.tx)("collaboration.voice.new_transcripts")),o.createElement("div",{className:"captions_dialog--header--SA3Wv",onClick:()=>u(!E)},o.createElement(K.B,{className:A?"captions_dialog--closedCaptionsIconMaximized--N-lwT":"captions_dialog--closedCaptionsIconMinimized--Ou0WE",svg:Z.A}),o.createElement("span",{className:"captions_dialog--label---1DXk"},(0,p.tx)("collaboration.voice.closed_captions")),o.createElement(z.Ex,{text:(0,p.t)("collaboration.voice.beta"),className:"captions_dialog--betaTag--qFyxq",color:z.zE.BRAND}),o.createElement(q.K0,{svg:ee.A,ref:O,className:"captions_dialog--typeSizeIcon--Xhxj-",onClick:e=>{e.stopPropagation(),N(X.gR({type:et}))},"data-tooltip-type":I.Ib.TEXT,"data-tooltip":(0,p.t)("collaboration.voice.text_size")}),O.current&&y&&o.createElement(Y.j,{dispatch:N,items:Object.keys(t).map(e=>({name:e,displayText:t[e].label,className:[t[e].style,"captions_dialog--dropdownTextOptions--ma0Ue"].join(" "),isChecked:t[e].style===l})),showPoint:!0,parentRect:O.current?.getBoundingClientRect(),onSelectItem:e=>{e.name&&s(t[e.name].style)},minWidth:96}),o.createElement("div",{style:{clear:"both"}})))}var el=a(325655),es=a(118786),er=a(517333),ec=a(966712),ed=a(951158),e_=a(247866);let em=[_.$E.WARNING_RECV_AUDIO_DECODE_FAILED,_.$E.WARNING_SEND_AUDIO_BITRATE_TOO_LOW,_.$E.WARNING_AUDIO_OUTPUT_LEVEL_TOO_LOW,_.$E.WARNING_AUDIO_INPUT_LEVEL_TOO_LOW];function eE(e){let t;if((0,ed.Im)(e.activeWarnings))return null;for(let a of em)if(e.activeWarnings[a]){t=e.activeWarnings[a];break}return t?o.createElement("div",{className:e.className,"data-tooltip-type":I.Ib.TEXT,"data-tooltip":t,"data-tooltip-show-below":!0,"data-tooltip-timeout-delay":50},o.createElement(K.B,{className:b,svg:e_.A})):null}function eu(e){if((0,ec.kc)().voice_localization_june_24)switch(e){case _.$E.WARNING_AUDIO_INPUT_LEVEL_TOO_LOW:return(0,p.t)("collaboration.voice.audio_input_too_low_warning");case _.$E.WARNING_AUDIO_OUTPUT_LEVEL_TOO_LOW:return(0,p.t)("collaboration.voice.speaker_volume_too_low_warning");case _.$E.WARNING_SEND_AUDIO_BITRATE_TOO_LOW:case _.$E.WARNING_RECV_AUDIO_DECODE_FAILED:return(0,p.t)("collaboration.voice.poor_connection_warning");default:return null}switch(e){case _.$E.WARNING_AUDIO_INPUT_LEVEL_TOO_LOW:return"Mic volume low. Consider switching devices.";case _.$E.WARNING_AUDIO_OUTPUT_LEVEL_TOO_LOW:return"Speaker or headphone volume low. Consider switching devices.";case _.$E.WARNING_SEND_AUDIO_BITRATE_TOO_LOW:case _.$E.WARNING_RECV_AUDIO_DECODE_FAILED:return"Connection is poor. Check your internet or leave and rejoin the conversation.";default:return null}}function ep(e){let{callEvent:t,onClick:a,notificationUserId:i}=e.notification,[s,c]=o.useState(null),[d,m]=o.useState(!1),E=o.useRef(),u=o.useRef(t),[v,g]=o.useState(),N=(0,n.d4)(e=>e.multiplayer.allUsers),I=(0,n.d4)(e=>e.voice.voiceUsersById),w=(0,l.GS)(),h=o.useMemo(()=>{if(i){if(i in I)return I[i].name;let e=N.find(e=>e.userID===i);if(e)return e.name}return"User"},[i,I,N]),O=v?.href,y=o.useMemo(()=>O?"a":"div",[O]);if(o.useEffect(()=>()=>{E?.current&&clearTimeout(E.current)},[]),o.useEffect(()=>{let e=()=>{m(!1),c(null)};v?(m(!0),c(null),v.persist||c(setTimeout(()=>{e()},2e3))):e()},[v]),o.useEffect(()=>()=>{s&&clearTimeout(s)},[s]),o.useEffect(()=>{switch(u.current=t,t){case _.$E.CONNECTED:g({msg:(0,p.t)("collaboration.voice.connected"),type:_.w.SUCCESS,icon:w?o.createElement(es.g,null):void 0});break;case _.$E.CONNECTED_WITH_MIC_DISABLED:g({msg:(0,p.t)("collaboration.voice.connected_check_your_microphone_permissions_to_start_chatting"),allowMultiLine:!0,type:_.w.SUCCESS});break;case _.$E.CONNECTING:g({msg:(0,p.t)("collaboration.voice.connecting"),type:_.w.PENDING,persist:!0});break;case _.$E.ERROR:g({msg:(0,p.t)("collaboration.voice.something_went_wrong_try_again"),type:_.w.ERROR,persist:!0});break;case _.$E.CALL_INACTIVE:g({msg:(0,p.t)("collaboration.voice.things_got_quiet_for_awhile_so_we_ended_the_conversation"),type:_.w.PENDING,persist:!1,allowMultiLine:!0});break;case _.$E.TOKEN_WILL_EXPIRE:g({msg:(0,p.t)("collaboration.voice.it_s_been_quiet_for_a_while_so_we_ll_end_the_conversation_in_20_seconds_n_click_to_stay_on"),type:_.w.MESSAGE,persist:!0,onClick:a,allowMultiLine:!0});break;case _.$E.TOKEN_EXPIRED:g({msg:(0,p.t)("collaboration.voice.audio_has_timed_out_click_to_rejoin"),type:_.w.ERROR,persist:!0,onClick:a});break;case _.$E.USER_JOINED:g({truncatedPrefix:h,msg:(0,p.t)("collaboration.voice.joined"),type:_.w.MESSAGE});break;case _.$E.USER_LEFT:g({truncatedPrefix:h,msg:(0,p.t)("collaboration.voice.left"),type:_.w.MESSAGE});break;case _.$E.ERROR_MICROPHONE_PERMISSIONS_DENIED:let e=(0,p.t)("collaboration.voice.enable_mic_access_in_your_browser_to_join");er.eD&&(e=(0,p.t)("collaboration.voice.enable_mic_access_for_the_figma_app_to_join")),g({msg:e,type:_.w.ERROR,href:r.AM.TROUBLESHOOT});break;case _.$E.WARNING_MICROPHONE_LEVELS_HIGH_AND_MUTED:g({msg:(0,p.t)("collaboration.voice.want_to_unmute_click_the_mic"),type:_.w.PENDING});break;case _.$E.ERROR_ON_LEAVE:g({msg:(0,p.t)("collaboration.voice.couldn_t_leave_please_try_again"),type:_.w.ERROR});break;case _.$E.SYSTEM_INCOMPATIBLE:g({msg:(0,p.t)("collaboration.voice.figma_audio_won_t_work_on_your_device_learn_why"),type:_.w.ERROR,persist:!0,allowMultiLine:!0,href:r.AM.TROUBLESHOOT});break;case _.$E.DISCONNECTING:case _.$E.RECONNECTING:E.current=setTimeout(()=>{u.current===_.$E.RECONNECTING&&(g({msg:(0,p.t)("collaboration.voice.attempting_to_reconnect"),type:_.w.PENDING,persist:!0}),E.current=void 0)},1500);break;case _.$E.WARNING_AUDIO_INPUT_LEVEL_TOO_LOW:case _.$E.WARNING_AUDIO_OUTPUT_LEVEL_TOO_LOW:case _.$E.WARNING_SEND_AUDIO_BITRATE_TOO_LOW:case _.$E.WARNING_RECV_AUDIO_DECODE_FAILED:let n=eu(t);if(!n)break;g({msg:n,type:_.w.WARNING,allowMultiLine:!0})}},[t]),void 0===t)return o.createElement(o.Fragment,null);let T=["expanded"===e.widgetState?"voice_flash_notifications--flashExpandedList--NkNnw voice_flash_notifications--flash--8i3SH":"voice_flash_notifications--flash--8i3SH",d?function(){switch(v?.type){case _.w.ERROR:return"voice_flash_notifications--flashError--6fLPW";case _.w.WARNING:return"voice_flash_notifications--flashWarning--tdCit";case _.w.MESSAGE:return"voice_flash_notifications--flashMessage--lt-k-";case _.w.SUCCESS:return"voice_flash_notifications--flashSuccess--hmpUM";case _.w.PENDING:default:return"voice_flash_notifications--flashPending--Hzt7W"}}():"voice_flash_notifications--flashHidden--uYI96"];return o.createElement(f.Id,{onClick:v?.onClick,className:T.join(" ")},o.createElement(y,{className:v?.allowMultiLine||w?"voice_flash_notifications--flashNotificationMessageWrap--eXghM voice_flash_notifications--flashNotificationMessageBase--wxFPN":"voice_flash_notifications--flashNotificationMessageEllipsis--eBEYX voice_flash_notifications--flashNotificationMessageBase--wxFPN ellipsis--ellipsis--Tjyfa",target:"_blank",rel:"noopener",href:v?.href},v?.truncatedPrefix&&o.createElement("span",{className:"voice_flash_notifications--truncatedPrefix---gMQI ellipsis--ellipsis--Tjyfa"},v?.truncatedPrefix),v?.icon,v?.msg))}var ev=a(96328),eg=a(355819),eN=a(70699),eI=a(27947),ef=a(749283);let ew="active_speakers_row--name--LtwVz ellipsis--ellipsis--Tjyfa",eh="active_speakers_row--pos1--88uza active_speakers_row--pos--D59NJ",eO="active_speakers_row--fadeOut--2tZhG",ey="active_speakers_row--willFadeIn--fFCX6",eT="active_speakers_row--activeSpeakerRowAvatar--zKOXb",eb=(e,t)=>e.userID===t.userID,eA=(e,t)=>{let a=e.sort((e,t)=>e.userID>t.userID?-1:1).map(e=>e.userID),o=t.sort((e,t)=>e.userID>t.userID?-1:1).map(e=>e.userID);if(a.length!==o.length)return!0;for(let e=0;e<a.length;e++)if(a[e]!==o[e])return!0;return!1},eC=(e,t)=>{let a=t.filter(t=>!e.find(e=>eb(e,t))),o=e.filter(e=>!t.find(t=>eb(e,t))),n=e.map(e=>o.indexOf(e)>-1?e:void 0),i=e.map(e=>-1===o.indexOf(e)?e:a.shift()).filter(e=>!!e);return a.length>0&&i.push(...a),t.length>1&&1===e.length&&(n[1]=e[0]),{fadeOut:n,active:i}},eD=(0,n.Ng)((e,t)=>({...t,observingSessionID:e.multiplayer.observingSessionID,presenterSessionID:e.multiplayer.presenterSessionID??null}))(function({user:e,classNames:t,observingSessionID:a,presenterSessionID:n,call:i}){let l;let s=(Array.isArray(t)?[...t,eT]:[t,eT]).join(" "),c=(0,r.eo)(),d=o.createElement(H.Ro,{entity:{...e,id:e.userID},className:"active_speakers_row--activeSpeakerRowAvatarWithoutMultiplayer--W-S0A",size:24,key:e.userID}),m=e=>{e.stopPropagation()};return"sessionID"in e&&(l=`active-speaker-row-voice-avatar-session-${e.sessionID}`,d=o.createElement(eI.vQ,{sessionID:e?.sessionID,observingSessionID:a,presenterSessionID:n??null,nominatedSessionID:null,user:e,showColorIndicators:!0,tooltipProxyId:l}),m=t=>{t.stopPropagation(),t.preventDefault(),c(e)}),o.createElement("div",{className:s},o.createElement("div",{className:"active_speakers_row--avatarObserveClickTarget--T1JH- voice_toolbar--avatarObserveClickTarget--QALFw",onClick:m,"data-tooltip-proxy-element-id":l}),d,o.createElement(ef.i,{userId:e.userID,microphoneStyle:_.bU.FULL,call:i,volumeIconMutedState:ef.S.MINI,className:"active_speakers_row--voiceIndicatorPositioning--YqGFz"}))});function eR({user:e,classNames:t}){return o.createElement("div",{className:ew+" "+(Array.isArray(t)?t.join(" "):t)},e.name)}let ek=["active_speakers_row--pos0--Dc1bB active_speakers_row--pos--D59NJ",eh,"active_speakers_row--pos2--b5pkb active_speakers_row--pos--D59NJ","active_speakers_row--pos3--EAAkN active_speakers_row--pos--D59NJ","active_speakers_row--pos4--R5-5y active_speakers_row--pos--D59NJ","active_speakers_row--pos5--FYPvT active_speakers_row--pos--D59NJ","active_speakers_row--pos6--PTsn8 active_speakers_row--pos--D59NJ","active_speakers_row--pos7--DjtPj active_speakers_row--pos--D59NJ"];class eS extends o.Component{constructor(e){super(e),this.displayString="ActiveSpeakersRow",this.node=null,this.state={active:[],fadeOut:[]}}componentWillMount(){this.setState(eC(this.state.active,this.props.users))}shouldComponentUpdate(e,t){return e===this.props||(eA(this.props.users,e.users)&&this.setState(eC(this.state.active,e.users)),!1)}render(){let e=(e,t)=>`${e.name}-${t}`,t=[],a=c.h.getInstance();if(!a)return null;if(1===this.state.fadeOut.length&&this.state.fadeOut[0]){let n=this.state.fadeOut[0];t.push(o.createElement(eD,{call:a,key:e(n,"avatar"),user:n,classNames:[ek[0],eO]}),o.createElement(eR,{key:e(n,"name"),user:n,classNames:[eh,eO,ew]}))}else if(2===this.state.fadeOut.length&&!this.state.fadeOut[0]&&this.state.fadeOut[1]){let a=this.state.fadeOut[1];t.push(o.createElement(eR,{key:e(a,"name"),user:a,classNames:[eh,eO,ew]}))}else t.push.apply(t,this.state.fadeOut.map((t,n)=>t&&o.createElement(eD,{call:a,key:e(t,"avatar"),user:t,classNames:[ek[n],eO]})));if(1===this.state.active.length){let n=this.state.active[0];t.push(o.createElement(eD,{call:a,key:e(n,"avatar"),user:n,classNames:[ek[0],ey]}),o.createElement(eR,{key:e(n,"name"),user:n,classNames:[eh,ey,ew]}))}else t.push.apply(t,this.state.active.map((t,n)=>o.createElement(eD,{call:a,key:e(t,"avatar"),user:t,classNames:[ek[n],ey]})));return t.sort((e,t)=>null===e.key||null===t.key?0:e.key>t.key?-1:1),setTimeout(()=>{this.node?.querySelectorAll("."+ey).forEach(e=>e.classList.remove(ey))},10),o.createElement("div",{ref:e=>this.node=e,className:"active_speakers_row--activeSpeakerRow--l5ylB"},t)}}function eL(e){let{call:t,usersInCall:a}=e,n=(0,s.iZ)(),i=(0,F.mt)(t),l=o.useMemo(()=>i?.filter(e=>e!==n?.id)?.slice(0,6).reduce((e,t)=>{let o=a.find(({userID:e})=>e===t);return o?e.concat([o]):e},[])||[],[i,a,n]);return o.createElement(eS,{users:l})}var eW=a(783423),eP=a(560560);function eU(e){let{children:t,headerText:a,collapsedContent:n,theme:i,onToggle:l,collapseStateOverride:s}=e,[r,c]=o.useState(!1),d=s||r;return o.createElement("span",{"data-editor-theme":i},o.createElement(f.fI,{className:d?"voice_collapsible_dropdown--isCollapsed--SwBvz":""},o.createElement("span",{className:"voice_collapsible_dropdown--dropdownSectionTitle--lpt22",onClick:t=>{t.preventDefault(),t.stopPropagation(),l&&!0!==e.hideToggleOption&&l(!d),c(!d)}},d?n:a,!e.hideToggleOption&&o.createElement(K.B,{svg:d?eW.A:eP.A,className:"voice_collapsible_dropdown--voiceDropdownChevronIcon--JgQxE"}))),!d&&t&&o.createElement(o.Fragment,null,t))}var ex=a(847768);let eM=(0,n.Ng)(e=>({showWidgetParticipantList:e.voice.showWidgetParticipantList}))(function(e){let{showWidgetParticipantList:t}=e,a=(0,s.iZ)(),l=(0,n.wA)(),{userIdsInCall:c}=(0,d.W5)(e.fileKey),m=(0,d.bF)(c,e.fileKey),E=(0,r.eo)(),{usersInCall:u,callMetadata:p}=o.useMemo(()=>({usersInCall:m.filter(e=>e.userID!==a?.id),callMetadata:{microphoneStyle:_.bU.FULL,call:e.call}}),[m,a,e.call]);return o.createElement(o.Fragment,null,o.createElement(eI.sK,null),u.length>0&&o.createElement("div",{className:ex.ev},o.createElement(eU,{headerText:`${e.currentUserInCall?"You and ":""}`+(0,ev.td)(u.length,"person","people")+" in conversation",collapseStateOverride:!t,collapsedContent:o.createElement(eL,{usersInCall:u,call:e.call}),hideToggleOption:u.length<2,onToggle:e=>l(i.yF(!e))},o.createElement(eg.P,{className:ex.YM},u.map(e=>o.createElement(eN.Q,{key:"sessionID"in e?e.sessionID:e.userID,callMetadata:p,user:e,isOverflow:!0,onUserClick:E}))))))});var e$=a(256296),eG=a(879078),eB=a(173919),eV=a(43604);function eF(e){return o.createElement("svg",{width:"24",height:"24",fill:"none",viewBox:"0 0 24 24",...e},o.createElement("path",{fill:"var(--color-icon)",fillRule:"evenodd",d:"M7 7h10a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V8a1 1 0 0 1 1-1M5 8a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2zm4.5 7a.5.5 0 0 0 0 1h2a.5.5 0 0 0 0-1zm4.5-1.5a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5m-3.5-.5a.5.5 0 0 0 0 1h2a.5.5 0 0 0 0-1zm2.5 2.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 0 1h-1a.5.5 0 0 1-.5-.5M7.5 13a.5.5 0 0 0 0 1h1a.5.5 0 0 0 0-1z",clipRule:"evenodd"}))}var eH=a(776250),ej=a(91408),ez=a(44948),eK=a(799569),eX=a(493323),eJ=a(392592),eY=a(672517),eq=a(298543),eQ=a(538697),eZ=a(837746);let e0="device_controls--pointingDropdown--hSJ1h",e1="device_controls--containerWithPadding--IlJeH",e5="device_controls--deviceControlRow--kSC19",e2="device_controls--controlLabel--Yp1lV",e9="device_controls--iconContainer--TuXUt",e8="device_controls--dropdownContainer--DfMXW",e3="device_controls--dropdownInput--w72f-",e4="device_controls--dropdownChevron--UBe58",e6="device_controls--divider--Z8rM-";var e7=a(909345);let te="MICROPHONE_CONTROL_DROPDOWN",tt="PLAYBACK_DEVICE_CONTROL_DROPDOWN",ta=(0,ej.jz)(eZ.aHA);function to(e,t,a,i,l,s,r){let c=(0,n.wA)(),[d,_]=(0,o.useState)(null),[m,E]=(0,o.useState)([]),v=(0,n.d4)(e=>e.dropdownShown?.type===i),g=(0,ez.wm)(()=>m.map(e=>e.deviceId),[m]),N=(0,o.useCallback)(async()=>{try{let e=await t(),a=new Set(g);(g.length!==e.length||e.some(e=>!(e.deviceId in a)))&&E(e)}catch{r||c(eJ.F.enqueue({message:(0,p.t)("collaboration.voice.error_fetching_devices"),error:!0,type:"voice-device-error"}))}},[g,c,t,r]),I=(0,o.useCallback)(async()=>{try{if(s&&!u.Ay.chrome)return;let t=await e();t.deviceId!==d?.deviceId&&_(t)}catch{}},[s,e,d]),f=(0,o.useCallback)(async e=>{e.deviceId!==d?.deviceId&&_(e);try{await a(e)}catch{c(eJ.F.enqueue({message:(0,p.t)("collaboration.voice.error_selecting_device"),error:!0,type:"voice-device-error"})),await I()}},[I,a,c,d]);return(0,o.useEffect)(()=>{(l||v)&&N()},[l,v,N]),(0,o.useEffect)(()=>{I(),N()},[]),[d,m,f]}function tn(e){let[t,a,n]=to(e.call.currentMicrophone,e.call.getMicrophones,e.call.setMicrophone,te,e.isOpen,!1,e.microphonePermissionDenied),[i,l,s]=to(e.call.currentPlaybackDevice,e.call.getPlaybackDevices,e.call.setPlaybackDevice,te,e.isOpen,!0,e.microphonePermissionDenied),r=e.targetRef.current?.getBoundingClientRect();return e.isOpen?o.createElement(ti,{targetRect:r,currentMicrophone:t,microphoneDevices:a,setMicrophone:n,currentPlaybackDevice:i,playbackDevices:l,setPlaybackDevice:s}):null}function ti(e){let{targetRect:t,currentMicrophone:a,microphoneDevices:i,setMicrophone:s,currentPlaybackDevice:r,playbackDevices:c,setPlaybackDevice:d}=e,_=(0,n.wA)(),m=(0,l.GS)(),[E,v]=(0,o.useState)({type:""}),g=()=>{v({type:""})},N={format:e=>e?.label||"",isEqual:(e,t)=>e.deviceId===t.deviceId},I=m?o.createElement(x.U,{svg:e7.A},o.createElement(eB.P,null)):void 0,h=m?o.createElement(x.U,{svg:e7.A},o.createElement(eV.L,null)):void 0,O=o.createElement(eQ.l6,{className:e8,inputClassName:e3,chevronClassName:e4,id:te,icon:I,property:a||{deviceId:"not_found",label:(0,p.t)("collaboration.voice.microphone_not_found"),groupId:"not_found",kind:"audioinput",toJSON:()=>null},dispatch:_,dropdownShown:E,onChange:e=>{s(e)},formatter:N,neverConstrain:!0,onHideDropdownOverride:g,onShowDropdownOverride:()=>v({type:te})},i.map(e=>o.createElement(eQ.c$,{key:e.deviceId,value:e},e.label))),y=o.createElement(eQ.l6,{className:e8,inputClassName:e3,chevronClassName:e4,id:tt,property:r||{deviceId:"not_found",label:(0,p.t)("collaboration.voice.playback_device_not_found"),groupId:"not_found",kind:"audiooutput",toJSON:()=>null},icon:h,dispatch:_,dropdownShown:E,onChange:e=>{d(e)},formatter:N,neverConstrain:!0,onHideDropdownOverride:g,onShowDropdownOverride:()=>v({type:tt})},c.map(e=>o.createElement(eQ.c$,{key:e.deviceId,value:e},e.label))),T=o.createElement(o.Fragment,null,o.createElement("div",{className:e6}),!(0,V.WO)()&&o.createElement(ts,null),(0,V.WO)()&&o.createElement(tl,null));return m?o.createElement(eq.Cf,{className:e0,targetRect:t,minWidth:ta,propagateCloseClick:!0,lean:"left",leanPadding:52},o.createElement("div",{onClick:e=>e.stopPropagation()},o.createElement("div",{className:"device_controls--header---h3P-"},(0,p.t)("collaboration.voice.audio_settings"),o.createElement(eK.Jn,{onClick:()=>_(M.oB())})),o.createElement("div",{className:"device_controls--container--VR8KK"},o.createElement(f.fI,{className:e5},o.createElement("span",{className:e2},(0,p.tx)("collaboration.voice.microphone")),O),u.Ay.chrome&&o.createElement(f.fI,{className:e5},o.createElement("span",{className:e2},(0,p.tx)("collaboration.voice.speakers")),y))),(0,V.X0)()&&T):o.createElement(eq.Cf,{showPoint:!!t,targetRect:t,className:e0,minWidth:280,propagateCloseClick:!0},o.createElement("div",{onClick:e=>e.stopPropagation()},o.createElement("div",{className:e1},o.createElement(f.fI,{className:e5},o.createElement("span",{className:e9},o.createElement(w.A.Unmuted,{size:24})),o.createElement("span",{className:e2},(0,p.tx)("collaboration.voice.microphone"))),o.createElement(f.fI,{className:e5},O)),u.Ay.chrome&&o.createElement(o.Fragment,null,o.createElement("div",{className:e6}),o.createElement("div",{className:e1},o.createElement(f.fI,{className:e5},o.createElement("span",{className:e9},o.createElement(K.B,{svg:e7.A})),o.createElement("span",{className:e2},(0,p.tx)("collaboration.voice.speakers"))),o.createElement(f.fI,{className:e5},y))),(0,V.X0)()&&T))}function tl(){let e=(0,n.d4)(e=>e.voice.captionsInstallProgress),t=(0,n.d4)(e=>e.voice.showCaptions),a=(0,n.wA)(),i=o.useId(),l=o.createElement(x.U,{className:e9,svg:Z.A},o.createElement(eF,null)),s=(0,p.tx)("collaboration.voice.closed_captioning"),r=o.createElement(z.Ex,{text:(0,p.t)("collaboration.voice.beta"),className:"device_controls--betaTag---VTFI",color:z.zE.BRAND});return t&&(0,V.Mw)(e)&&(s=(0,p.tx)("collaboration.voice.setting_up_closed_captions_install_progress",{installProgress:e}),l=o.createElement(eX.kt,{className:"device_controls--captionsLoadingSpinner--ivdGQ"}),r=o.createElement(o.Fragment,null)),o.createElement(e$.J,{className:"device_controls--closedCaptionRow--OdIHt raw_components--singleRow--W5dYN raw_components--_singleRow--yTGIY raw_components--singleRowHeight--dKM4t raw_components--_row--rHucX raw_components--row--NThzm device_controls--deviceControlRowWithHover--KUbHL device_controls--deviceControlRow--kSC19",htmlFor:i},l,o.createElement("span",{className:"device_controls--captionToggleLabel--MjCYn device_controls--controlLabelFullOpacity--1nEqI device_controls--controlLabel--Yp1lV"},s,r),o.createElement(eG.v,{id:i,checked:t,onChange:(e,{event:t})=>{t.stopPropagation(),(0,eH.sx)("voice_captions_toggle",{value:e,source:"voice_widget"}),(0,V.HJ)(a,e)}}))}function ts(){let e=r.AM.ACCESSIBILITY;return o.createElement(eY.L0,{target:"_blank",rel:"noopener",href:e,trackingEventName:"Learn more about captioning"},o.createElement(f.fI,{className:"device_controls--deviceControlRowWithHover--KUbHL device_controls--deviceControlRow--kSC19"},o.createElement(K.B,{className:e9,svg:Z.A}),o.createElement("span",{className:"device_controls--controlLabelFullOpacity--1nEqI device_controls--controlLabel--Yp1lV"},(0,p.tx)("collaboration.voice.learn_how_to_turn_on_closed_captioning"))))}var tr=a(654703),tc=a(776836);let td="DEVICE_CONTROL_DROPDOWN",t_=null,tm=null,tE=null;function tu(e){let{call:t,fileKey:a,user:s,callEvent:r,notificationUserId:c,callEventCallback:m}=e,u=(0,n.Pj)(),[v,g]=(0,o.useState)(null),[w,h]=(0,o.useState)(),[O,k]=(0,o.useState)(!1),[F,H]=(0,o.useState)(!1),[z,K]=(0,o.useState)(!1),[X,J]=(0,o.useState)(!1),Y=(0,n.d4)(e=>e.voice.snapWidget),[q,Q]=(0,o.useState)(!1),[Z,ee]=(0,o.useState)(!1),[et,ea]=(0,o.useState)({}),{userIdsInCall:eo}=(0,d.W5)(a);(0,B.W)();let en=(0,n.d4)(e=>e.voice.showCaptions),es=(0,n.d4)(e=>e.voice.captionsInstallProgress),er=(0,n.d4)(e=>e.dropdownShown?.type===td),ec=(0,n.d4)(e=>e.voice.activeCall[a]||!1),ed=(0,n.d4)(e=>e.voice.showWidgetParticipantList),e_=(0,o.useRef)(null),em=(0,l.GS)(),ev=(0,n.wA)(),eg={in:()=>{K(!0)},out:()=>(K(!1),new Promise(e=>setTimeout(e,300)))};o.useEffect(()=>{let e=t.getSystemCompatibility();if(g(e),!e){m(_.$E.SYSTEM_INCOMPATIBLE);return}return t_||tm||(tm=new Audio("https://static.figma.com/uploads/94721b53827c353075273e54a45ea41850ee0284"),(t_=new Audio("https://static.figma.com/uploads/d917bf9964749c47b46d367572a5dd28a559bd2f")).load(),tm.load(),[tm,t_].forEach(e=>e.volume=.5)),()=>{ev(i.Pp(!1))}},[]),o.useEffect(()=>{!ec&&v&&ef(),window.requestAnimationFrame(()=>eg.in())},[v]),o.useEffect(()=>{let e;switch(r){case _.$E.DISCONNECTED:Z&&(tm?.play(),ee(!1)),ev(i.oI({fileKey:a}));break;case _.$E.TOKEN_WILL_EXPIRE_DETECT_MIC_INPUT:(function e(a){if(Date.now()>=a){m(_.$E.TOKEN_WILL_EXPIRE);return}if(t.isLocalUserSpeaking()){eh(!1);return}setTimeout(()=>{e(a)},500)})(Date.now()+1e4);break;case _.$E.CONNECTED:case _.$E.CONNECTED_WITH_MIC_DISABLED:q&&(setTimeout(()=>t_?.play(),400),Q(!1)),ev(i.rO({fileKey:a}));break;case _.$E.CALL_INACTIVE:t.leave();break;case _.$E.TOKEN_WILL_EXPIRE:e=()=>eh(!0);break;case _.$E.TOKEN_EXPIRED:e=ef;break;case _.$E.USER_JOINED:case _.$E.USER_LEFT:if(tE)return;break;case _.$E.WARNING_AUDIO_INPUT_LEVEL_TOO_LOW:case _.$E.WARNING_AUDIO_OUTPUT_LEVEL_TOO_LOW:case _.$E.WARNING_SEND_AUDIO_BITRATE_TOO_LOW:case _.$E.WARNING_RECV_AUDIO_DECODE_FAILED:let o=eu(r);if(!o)break;ea({...et,[r]:o});break;case _.$E.WARNING_AUDIO_INPUT_LEVEL_TOO_LOW_RECOVER:case _.$E.WARNING_AUDIO_OUTPUT_LEVEL_TOO_LOW_RECOVER:case _.$E.WARNING_SEND_AUDIO_BITRATE_TOO_LOW_RECOVER:case _.$E.WARNING_RECV_AUDIO_DECODE_FAILED_RECOVER:let n=function(e){switch(e){case _.$E.WARNING_AUDIO_INPUT_LEVEL_TOO_LOW_RECOVER:return _.$E.WARNING_AUDIO_INPUT_LEVEL_TOO_LOW;case _.$E.WARNING_AUDIO_OUTPUT_LEVEL_TOO_LOW_RECOVER:return _.$E.WARNING_AUDIO_OUTPUT_LEVEL_TOO_LOW;case _.$E.WARNING_SEND_AUDIO_BITRATE_TOO_LOW_RECOVER:return _.$E.WARNING_SEND_AUDIO_BITRATE_TOO_LOW;case _.$E.WARNING_RECV_AUDIO_DECODE_FAILED_RECOVER:return _.$E.WARNING_RECV_AUDIO_DECODE_FAILED;default:return null}}(r);if(!n)break;delete et[n],ea(et)}void 0!==r&&h({callEvent:r,onClick:e,notificationUserId:c})},[r]),o.useEffect(()=>{J(!0)},[Y]),o.useEffect(()=>{X&&J(!1)},[X]);let[eN,eI]=(0,o.useState)(!0),ef=async()=>{if(eI(!0),!t.getSystemCompatibility()){eI(!1),m(_.$E.SYSTEM_INCOMPATIBLE);return}k(!0),Q(!0),tE=setTimeout(()=>{tE=null},5e3);try{let{data:e}=await U.Ay.post(`/api/voice/${a}/auth`),o=await (0,P.JL)(e.meta.user_encryption_key),n=await (0,P.We)(o,e.meta.call_user_id);if(n!=n)throw Error(`User ID does not match local user ID.
local: ${n}
remote: ${n}`);await t.join({appId:e.meta.app_id,callId:e.meta.call_id,token:e.meta.auth_token,callUserId:e.meta.call_user_id,userId:n,encryptionKey:e.meta.call_encryption_key,userEncryptionKey:o,setParticipantIdsCallback:ew,callEventCallback:m,store:u,fileKey:a})}catch(e){eI(!1),m(_.$E.ERROR)}k(!1),eI(!1)};function ew(e){ev(i.cb(e))}(0,N.N)({isVisible:z});let eh=async e=>{let{data:o}=await U.Ay.post(`/api/voice/${a}/auth`,{call_user_id:t.uid});await t.renewToken(o.meta.auth_token),e?m(_.$E.CONNECTED):m(_.$E.TOKEN_SILENTLY_RENEWED)},eO=async()=>{k(!0),ee(!0);try{await Promise.all([eg.out(),t.leave()]),ev(i.oI({fileKey:a})),tm?.play(),er&&ev(M.oB()),ev(i.Pp(!1))}catch{eg.in(),m(_.$E.ERROR_ON_LEAVE)}k(!1)},ey=async e=>{(0,G.ds)("voice_user_mute_toggle",a,u.getState(),{source:"voice_widget",muted:!e}),e?await t.unmute():await t.mute()},eT=w?w&&eo.size>1&&ed?"expanded":"collapsed":null;en&&(0,V.nN)(es)&&((0,G.ds)("voice_caption_download_error",a,u.getState(),{error_code:es,source:"voice_widget"}),(0,V.HJ)(ev,!1),ev((0,$.to)({type:j.L,data:{dispatch:ev,installProgress:es}})));let eb=o.createElement("span",{onClick:()=>{(0,G.ds)("voice_widget_minimized_toggle",a,u.getState(),{minimized:!1}),ev(i.Pp(!1))},className:["voice_widget--dismissButtonPosition--eEXoz",A].join(" "),"data-tooltip-type":I.Ib.TEXT,"data-tooltip":(0,p.t)("collaboration.voice.minimize")},o.createElement(x.U,{className:b,svg:tr.A,fallbackSvg:tr.A},o.createElement(L.A,null))),eA=(0,S.U1)();return o.createElement("div",{className:E()("voice_widget--hybridModalWrapper--x9-GE"),ref:eA},o.createElement("div",{className:E()(y,{[T]:z})},o.createElement(f.Id,{className:R},o.createElement("div",{className:D},o.createElement("span",{className:ec||F?"voice_widget--currentUser--L7Z6l":"voice_widget--inactiveCurrentUser--yVaZY voice_widget--currentUser--L7Z6l"},o.createElement(tp,{user:s,call:e.call})),o.createElement(eE,{className:"voice_widget--warningIcon--WJPdH",activeWarnings:et}),o.createElement(el.Y,{userId:s.id,onMuteButtonClickCallback:ey,disabled:t.microphonePermissionDenied,className:[C,A].join(" "),disabledClassName:[C,"voice_widget--muteButtonDisabled--fJzUI"].join(" ")}),o.createElement("span",{className:["voice_widget--controlsButtonPosition--TTGIU",er?"voice_widget--controlsButtonActive--vE2c-":A].join(" "),onMouseDown:()=>{er?ev(M.oB()):((0,G.ds)("voice_widget_open_settings",a,u.getState()),ev(M.j7({type:td})))},onClick:e=>e.stopPropagation(),ref:e_,"data-tooltip-type":I.Ib.TEXT,"data-tooltip":(0,p.t)("collaboration.voice.settings")},o.createElement(x.U,{className:b,svg:tc.A,fallbackSvg:tc.A},o.createElement(W.I,null))),o.createElement("button",{className:ec?"voice_widget--leaveButton--UUdxH basic_form--btn--FSrmp ellipsis--ellipsis--Tjyfa text--fontPos11--2LvXf text--_fontBase--QdLsd":"voice_widget--joinButton--WvZPr basic_form--btn--FSrmp ellipsis--ellipsis--Tjyfa text--fontPos11--2LvXf text--_fontBase--QdLsd",onClick:ec?eO:ef,disabled:!v||O,onMouseEnter:()=>H(!0),onMouseLeave:()=>H(!1)},ec||eN?(0,p.tx)("collaboration.voice.leave"):(0,p.tx)("collaboration.voice.join")),!em&&eb),ec&&o.createElement(eM,{fileKey:a,currentUserInCall:ec,call:t}),(0,V.WO)()&&en&&o.createElement(ei,{call:t})),!em&&w&&o.createElement(ep,{notification:w,widgetState:eT})),em&&w&&o.createElement(ep,{notification:w,widgetState:eT}),o.createElement(tn,{isOpen:er,call:t,targetRef:e_,microphonePermissionDenied:t.microphonePermissionDenied}))}function tp({user:e,call:t}){return o.createElement(o.Fragment,null,o.createElement(tv,{user:e,call:t}),o.createElement(H.Ro,{entity:e,size:24,className:"voice_widget--undraggableImage--muN9g"}))}function tv({user:e,call:t}){let a=(0,F.Wl)(e.id,t);return!a||a.isMuted?null:o.createElement(ef.i,{userId:e.id,microphoneStyle:_.bU.FULL,className:"voice_widget--avatarVoiceIndicator--zfWwx",volumeIconMutedState:ef.S.NONE,call:t})}function tg(){let e=(0,n.d4)(e=>e.mirror.appModel.showUi),t=(0,n.d4)(e=>e.openFile?.key||null),a=(0,s.iZ)(),m=(0,n.d4)(e=>e.voice.showWidget),E=(0,n.d4)(e=>t&&t in e.voice.activeCall),u=(0,n.d4)(e=>t&&!!e.voice.activeCall[t]),{userIdsInCall:p}=(0,d.W5)(t,!0),v=(0,d.bF)(p,t).length,g=(0,r.qr)(),N=(0,n.wA)(),[I,f]=(0,o.useState)(),[w,h]=(0,o.useState)(),O=(0,l.GS)(),y=o.useCallback((e,t)=>{_.GA.has(e)&&N(i.Pp(!0)),t&&h(t),f(e)},[N]),T=(0,n.d4)(e=>e.voice.captionsInstallProgress),b=(0,n.d4)(e=>e.voice.showCaptions);return(o.useEffect(()=>{g&&(g.captionsToggleEnabled=b,g.streamAudioForCaptions(b&&100===T))},[b,T,g]),o.useEffect(()=>{m||(h(void 0),f(void 0))},[m]),o.useEffect(()=>{t&&!E&&v>0?N(i.Zq({fileKey:t})):t&&E&&!u&&0===v&&N(i.a6({fileKey:t}))},[v,t,E,u,N]),o.useEffect(()=>()=>{c.h.leave(),t&&N(i.a6({fileKey:t}))},[N,t]),e&&t&&a)?O&&E&&!m?o.createElement(k,{fileKey:t}):g&&m?o.createElement(tu,{fileKey:t,user:a,call:g,notificationUserId:w,callEvent:I,callEventCallback:y}):o.createElement(o.Fragment,null):o.createElement(o.Fragment,null)}}}]);

//# debugId=7b061089-440e-5e62-9e93-19bd14bbde28

//# sourceMappingURL=https://admin.figma.com/admin/webpack-artifacts/4fff0f42930acfa54155d09c6bfab9d24b4ac7f1/6007-70d7bd7ab0eca0e0.min.js.map